import{Fragment as k,computed as v,defineComponent as h,h as L,inject as A,onMounted as w,onUnmounted as D,provide as j,ref as I,watchEffect as B}from"vue";import{Features as M,render as S,omit as F}from'../../utils/render.js';import{useId as H}from'../../hooks/use-id.js';import{Keys as b}from'../../keyboard.js';import{dom as y}from'../../utils/dom.js';import{match as C}from'../../utils/match.js';import{focusIn as P,Focus as m}from'../../utils/focus-management.js';import{useResolveButtonType as K}from'../../hooks/use-resolve-button-type.js';import{FocusSentinel as $}from'../../internal/focus-sentinel.js';import{microTask as G}from'../../utils/micro-task.js';import{Hidden as N}from'../../internal/hidden.js';let O=Symbol("TabsContext");function E(a){let u=A(O,null);if(u===null){let i=new Error(`<${a} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,E),i}return u}let le=h({name:"TabGroup",emits:{change:a=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(a,{slots:u,attrs:i,emit:f}){let e=I(null),o=I([]),n=I([]),c=v(()=>a.selectedIndex!==null),p=v(()=>c.value?a.selectedIndex:e.value),x={selectedIndex:e,orientation:v(()=>a.vertical?"vertical":"horizontal"),activation:v(()=>a.manual?"manual":"auto"),tabs:o,panels:n,setSelectedIndex(t){p.value!==t&&f("change",t),c.value||(e.value=t)},registerTab(t){o.value.includes(t)||o.value.push(t)},unregisterTab(t){let r=o.value.indexOf(t);r!==-1&&o.value.splice(r,1)},registerPanel(t){n.value.includes(t)||n.value.push(t)},unregisterPanel(t){let r=n.value.indexOf(t);r!==-1&&n.value.splice(r,1)}};return j(O,x),B(()=>{var R;if(x.tabs.value.length<=0||a.selectedIndex===null&&e.value!==null)return;let t=x.tabs.value.map(T=>y(T)).filter(Boolean),r=t.filter(T=>!T.hasAttribute("disabled")),s=(R=a.selectedIndex)!=null?R:a.defaultIndex;if(s<0)e.value=t.indexOf(r[0]);else if(s>x.tabs.value.length)e.value=t.indexOf(r[r.length-1]);else{let T=t.slice(0,s),d=[...t.slice(s),...T].find(g=>r.includes(g));if(!d)return;e.value=t.indexOf(d)}}),()=>{let t={selectedIndex:e.value};return L(k,[o.value.length<=0&&L($,{onFocus:()=>{for(let r of o.value){let s=y(r);if((s==null?void 0:s.tabIndex)===0)return s.focus(),!0}return!1}}),S({theirProps:{...i,...F(a,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:t,slots:u,attrs:i,name:"TabGroup"})])}}}),ae=h({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:u,slots:i}){let f=E("TabList");return()=>{let e={selectedIndex:f.selectedIndex.value},o={role:"tablist","aria-orientation":f.orientation.value};return S({ourProps:o,theirProps:a,slot:e,attrs:u,slots:i,name:"TabList"})}}}),ne=h({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(a,{attrs:u,slots:i,expose:f}){let e=E("Tab"),o=`headlessui-tabs-tab-${H()}`,n=I(null);f({el:n,$el:n}),w(()=>e.registerTab(n)),D(()=>e.unregisterTab(n));let c=v(()=>e.tabs.value.indexOf(n)),p=v(()=>c.value===e.selectedIndex.value);function x(l){let d=e.tabs.value.map(g=>y(g)).filter(Boolean);if(l.key===b.Space||l.key===b.Enter){l.preventDefault(),l.stopPropagation(),e.setSelectedIndex(c.value);return}switch(l.key){case b.Home:case b.PageUp:return l.preventDefault(),l.stopPropagation(),P(d,m.First);case b.End:case b.PageDown:return l.preventDefault(),l.stopPropagation(),P(d,m.Last)}if(C(e.orientation.value,{vertical(){if(l.key===b.ArrowUp)return P(d,m.Previous|m.WrapAround);if(l.key===b.ArrowDown)return P(d,m.Next|m.WrapAround)},horizontal(){if(l.key===b.ArrowLeft)return P(d,m.Previous|m.WrapAround);if(l.key===b.ArrowRight)return P(d,m.Next|m.WrapAround)}}))return l.preventDefault()}function t(){var l;(l=y(n))==null||l.focus()}let r=I(!1);function s(){var l;r.value||(r.value=!0,!a.disabled&&((l=y(n))==null||l.focus(),e.setSelectedIndex(c.value),G(()=>{r.value=!1})))}function R(l){l.preventDefault()}let T=K(v(()=>({as:a.as,type:u.type})),n);return()=>{var g;let l={selected:p.value},d={ref:n,onKeydown:x,onFocus:e.activation.value==="manual"?t:s,onMousedown:R,onClick:s,id:o,role:"tab",type:T.value,"aria-controls":(g=y(e.panels.value[c.value]))==null?void 0:g.id,"aria-selected":p.value,tabIndex:p.value?0:-1,disabled:a.disabled?!0:void 0};return S({ourProps:d,theirProps:a,slot:l,attrs:u,slots:i,name:"Tab"})}}}),re=h({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:u,attrs:i}){let f=E("TabPanels");return()=>{let e={selectedIndex:f.selectedIndex.value};return S({theirProps:a,ourProps:{},slot:e,attrs:i,slots:u,name:"TabPanels"})}}}),ue=h({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:u,slots:i,expose:f}){let e=E("TabPanel"),o=`headlessui-tabs-panel-${H()}`,n=I(null);f({el:n,$el:n}),w(()=>e.registerPanel(n)),D(()=>e.unregisterPanel(n));let c=v(()=>e.panels.value.indexOf(n)),p=v(()=>c.value===e.selectedIndex.value);return()=>{var r;let x={selected:p.value},t={ref:n,id:o,role:"tabpanel","aria-labelledby":(r=y(e.tabs.value[c.value]))==null?void 0:r.id,tabIndex:p.value?0:-1};return!p.value&&a.unmount&&!a.static?L(N,{as:"span",...t}):S({ourProps:t,theirProps:a,slot:x,attrs:u,slots:i,features:M.Static|M.RenderStrategy,visible:p.value,name:"TabPanel"})}}});export{ne as Tab,le as TabGroup,ae as TabList,ue as TabPanel,re as TabPanels};
